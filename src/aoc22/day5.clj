(ns day5
  (:require [clojure.string :as str]))

; Day 5 / #1 =====================================================================================================================

(defn translate-instructions [instructions]
  (for [i instructions]
    (map #(Integer/parseInt %) (re-seq #"\d+" i))
    )
  )

(def instruction-list (translate-instructions (str/split-lines "move 1 from 5 to 6\nmove 5 from 6 to 7\nmove 10 from 7 to 3\nmove 4 from 8 to 4\nmove 2 from 5 to 4\nmove 4 from 3 to 6\nmove 6 from 2 to 4\nmove 8 from 6 to 9\nmove 5 from 9 to 2\nmove 7 from 2 to 7\nmove 2 from 1 to 4\nmove 3 from 3 to 8\nmove 1 from 5 to 9\nmove 1 from 3 to 8\nmove 1 from 1 to 2\nmove 11 from 4 to 6\nmove 2 from 5 to 6\nmove 10 from 9 to 1\nmove 4 from 8 to 3\nmove 7 from 7 to 1\nmove 9 from 1 to 2\nmove 1 from 6 to 5\nmove 1 from 5 to 9\nmove 5 from 3 to 8\nmove 2 from 9 to 1\nmove 5 from 3 to 9\nmove 3 from 6 to 8\nmove 5 from 9 to 6\nmove 6 from 6 to 3\nmove 3 from 3 to 2\nmove 1 from 9 to 8\nmove 13 from 2 to 3\nmove 3 from 8 to 1\nmove 11 from 1 to 4\nmove 3 from 4 to 1\nmove 2 from 6 to 5\nmove 4 from 6 to 8\nmove 17 from 3 to 9\nmove 1 from 1 to 8\nmove 1 from 6 to 5\nmove 1 from 3 to 7\nmove 1 from 7 to 4\nmove 3 from 4 to 1\nmove 1 from 3 to 8\nmove 4 from 8 to 1\nmove 3 from 5 to 9\nmove 1 from 6 to 4\nmove 4 from 4 to 8\nmove 2 from 8 to 4\nmove 2 from 1 to 6\nmove 4 from 8 to 6\nmove 1 from 8 to 3\nmove 6 from 6 to 3\nmove 6 from 3 to 9\nmove 6 from 1 to 4\nmove 5 from 8 to 4\nmove 1 from 3 to 6\nmove 3 from 1 to 7\nmove 1 from 6 to 7\nmove 4 from 4 to 5\nmove 24 from 9 to 5\nmove 2 from 9 to 1\nmove 27 from 5 to 7\nmove 13 from 7 to 2\nmove 1 from 5 to 9\nmove 7 from 2 to 7\nmove 1 from 9 to 8\nmove 5 from 2 to 8\nmove 1 from 2 to 5\nmove 1 from 5 to 7\nmove 21 from 4 to 1\nmove 1 from 4 to 6\nmove 1 from 6 to 5\nmove 22 from 7 to 5\nmove 2 from 7 to 8\nmove 7 from 5 to 4\nmove 1 from 4 to 5\nmove 2 from 7 to 9\nmove 5 from 5 to 2\nmove 5 from 4 to 2\nmove 3 from 5 to 1\nmove 7 from 8 to 7\nmove 1 from 4 to 1\nmove 23 from 1 to 8\nmove 2 from 9 to 4\nmove 11 from 8 to 3\nmove 3 from 1 to 3\nmove 1 from 4 to 2\nmove 12 from 3 to 2\nmove 7 from 7 to 3\nmove 3 from 2 to 1\nmove 1 from 4 to 9\nmove 1 from 1 to 3\nmove 9 from 8 to 6\nmove 2 from 5 to 4\nmove 3 from 1 to 7\nmove 3 from 2 to 4\nmove 7 from 2 to 3\nmove 9 from 3 to 4\nmove 7 from 5 to 2\nmove 2 from 7 to 2\nmove 1 from 7 to 2\nmove 13 from 4 to 6\nmove 1 from 9 to 8\nmove 2 from 8 to 2\nmove 12 from 2 to 1\nmove 3 from 3 to 1\nmove 1 from 8 to 1\nmove 5 from 3 to 7\nmove 3 from 2 to 8\nmove 7 from 2 to 5\nmove 3 from 8 to 3\nmove 1 from 4 to 8\nmove 22 from 6 to 4\nmove 1 from 3 to 6\nmove 3 from 5 to 8\nmove 4 from 5 to 8\nmove 1 from 3 to 9\nmove 8 from 4 to 2\nmove 8 from 8 to 3\nmove 1 from 6 to 3\nmove 4 from 2 to 6\nmove 1 from 9 to 4\nmove 5 from 3 to 9\nmove 2 from 8 to 1\nmove 3 from 2 to 1\nmove 10 from 4 to 8\nmove 4 from 7 to 6\nmove 10 from 1 to 3\nmove 9 from 8 to 2\nmove 1 from 7 to 1\nmove 15 from 3 to 1\nmove 1 from 8 to 9\nmove 4 from 4 to 1\nmove 17 from 1 to 3\nmove 3 from 2 to 3\nmove 3 from 6 to 8\nmove 5 from 9 to 7\nmove 11 from 1 to 8\nmove 4 from 7 to 8\nmove 6 from 2 to 5\nmove 2 from 1 to 4\nmove 4 from 6 to 8\nmove 16 from 8 to 6\nmove 2 from 6 to 1\nmove 1 from 9 to 5\nmove 1 from 7 to 5\nmove 2 from 5 to 6\nmove 5 from 6 to 3\nmove 2 from 8 to 5\nmove 1 from 2 to 1\nmove 10 from 6 to 3\nmove 6 from 5 to 9\nmove 2 from 1 to 2\nmove 2 from 4 to 2\nmove 1 from 2 to 4\nmove 5 from 9 to 2\nmove 1 from 4 to 3\nmove 1 from 9 to 7\nmove 1 from 6 to 1\nmove 1 from 1 to 7\nmove 2 from 7 to 5\nmove 7 from 2 to 5\nmove 6 from 5 to 1\nmove 1 from 2 to 3\nmove 1 from 4 to 1\nmove 2 from 8 to 9\nmove 8 from 1 to 3\nmove 2 from 5 to 3\nmove 29 from 3 to 9\nmove 5 from 3 to 8\nmove 6 from 8 to 5\nmove 1 from 6 to 5\nmove 6 from 3 to 2\nmove 2 from 2 to 4\nmove 1 from 1 to 7\nmove 18 from 9 to 6\nmove 2 from 2 to 9\nmove 2 from 2 to 8\nmove 13 from 6 to 8\nmove 1 from 7 to 4\nmove 3 from 5 to 6\nmove 1 from 5 to 7\nmove 1 from 7 to 4\nmove 14 from 9 to 3\nmove 3 from 4 to 5\nmove 1 from 9 to 7\nmove 14 from 3 to 2\nmove 1 from 7 to 3\nmove 4 from 2 to 5\nmove 16 from 8 to 6\nmove 11 from 6 to 9\nmove 13 from 6 to 4\nmove 5 from 5 to 2\nmove 12 from 2 to 4\nmove 19 from 4 to 3\nmove 7 from 4 to 5\nmove 14 from 5 to 2\nmove 2 from 3 to 6\nmove 3 from 9 to 5\nmove 2 from 6 to 2\nmove 1 from 5 to 2\nmove 3 from 5 to 4\nmove 3 from 4 to 1\nmove 7 from 9 to 6\nmove 4 from 6 to 1\nmove 1 from 1 to 8\nmove 3 from 6 to 9\nmove 1 from 8 to 7\nmove 1 from 9 to 6\nmove 4 from 1 to 2\nmove 1 from 7 to 2\nmove 2 from 9 to 8\nmove 10 from 2 to 9\nmove 2 from 2 to 9\nmove 11 from 3 to 7\nmove 1 from 8 to 9\nmove 2 from 3 to 7\nmove 1 from 1 to 7\nmove 10 from 2 to 4\nmove 3 from 4 to 1\nmove 4 from 1 to 8\nmove 1 from 6 to 5\nmove 6 from 7 to 9\nmove 3 from 9 to 1\nmove 1 from 5 to 1\nmove 4 from 4 to 2\nmove 5 from 2 to 1\nmove 1 from 2 to 7\nmove 2 from 7 to 6\nmove 1 from 2 to 1\nmove 2 from 9 to 1\nmove 3 from 4 to 7\nmove 1 from 3 to 7\nmove 2 from 8 to 3\nmove 2 from 6 to 5\nmove 2 from 5 to 8\nmove 10 from 7 to 2\nmove 6 from 9 to 1\nmove 1 from 7 to 3\nmove 2 from 8 to 9\nmove 7 from 3 to 7\nmove 7 from 3 to 9\nmove 1 from 8 to 9\nmove 6 from 2 to 8\nmove 13 from 9 to 1\nmove 6 from 9 to 8\nmove 2 from 2 to 7\nmove 3 from 7 to 1\nmove 1 from 8 to 1\nmove 1 from 1 to 6\nmove 16 from 1 to 4\nmove 2 from 7 to 5\nmove 12 from 4 to 9\nmove 4 from 8 to 6\nmove 2 from 5 to 1\nmove 8 from 8 to 4\nmove 2 from 4 to 5\nmove 1 from 8 to 6\nmove 4 from 6 to 8\nmove 19 from 1 to 9\nmove 3 from 8 to 5\nmove 1 from 6 to 9\nmove 2 from 2 to 1\nmove 10 from 4 to 9\nmove 1 from 1 to 2\nmove 2 from 1 to 5\nmove 4 from 7 to 9\nmove 1 from 8 to 2\nmove 1 from 2 to 6\nmove 7 from 5 to 4\nmove 11 from 9 to 8\nmove 1 from 4 to 3\nmove 10 from 8 to 1\nmove 1 from 2 to 3\nmove 29 from 9 to 3\nmove 2 from 6 to 5\nmove 1 from 5 to 3\nmove 5 from 9 to 3\nmove 1 from 8 to 9\nmove 1 from 9 to 3\nmove 6 from 4 to 6\nmove 1 from 5 to 1\nmove 1 from 6 to 3\nmove 2 from 1 to 5\nmove 1 from 9 to 5\nmove 37 from 3 to 2\nmove 3 from 6 to 2\nmove 1 from 6 to 2\nmove 1 from 6 to 4\nmove 3 from 1 to 3\nmove 2 from 1 to 6\nmove 35 from 2 to 1\nmove 1 from 6 to 8\nmove 5 from 1 to 8\nmove 7 from 1 to 6\nmove 5 from 3 to 7\nmove 1 from 8 to 7\nmove 3 from 7 to 5\nmove 4 from 2 to 9\nmove 1 from 2 to 1\nmove 1 from 4 to 3\nmove 3 from 7 to 1\nmove 1 from 3 to 6\nmove 1 from 1 to 9\nmove 5 from 9 to 2\nmove 18 from 1 to 3\nmove 6 from 1 to 8\nmove 6 from 3 to 7\nmove 4 from 8 to 6\nmove 4 from 6 to 7\nmove 9 from 7 to 8\nmove 3 from 2 to 7\nmove 4 from 6 to 1\nmove 3 from 5 to 3\nmove 3 from 2 to 5\nmove 3 from 6 to 1\nmove 4 from 7 to 4\nmove 6 from 5 to 9\nmove 3 from 1 to 9\nmove 1 from 6 to 1\nmove 15 from 8 to 2\nmove 1 from 8 to 5\nmove 3 from 4 to 8\nmove 1 from 5 to 1\nmove 1 from 6 to 5\nmove 11 from 3 to 9\nmove 12 from 2 to 3\nmove 3 from 8 to 1\nmove 15 from 1 to 2\nmove 8 from 9 to 4\nmove 8 from 4 to 9\nmove 4 from 2 to 5\nmove 1 from 4 to 6\nmove 1 from 2 to 8\nmove 1 from 6 to 7\nmove 4 from 3 to 1\nmove 1 from 8 to 5\nmove 5 from 3 to 9\nmove 14 from 9 to 2\nmove 1 from 7 to 4\nmove 4 from 1 to 3\nmove 1 from 4 to 7\nmove 8 from 3 to 7\nmove 8 from 7 to 5\nmove 1 from 7 to 9\nmove 3 from 3 to 2\nmove 7 from 9 to 8\nmove 1 from 9 to 5\nmove 2 from 8 to 5\nmove 7 from 5 to 4\nmove 4 from 9 to 2\nmove 6 from 4 to 3\nmove 18 from 2 to 5\nmove 1 from 4 to 7\nmove 15 from 5 to 4\nmove 1 from 4 to 6\nmove 2 from 2 to 7\nmove 3 from 8 to 5\nmove 1 from 7 to 3\nmove 8 from 2 to 6\nmove 4 from 2 to 3\nmove 1 from 7 to 5\nmove 3 from 4 to 6\nmove 5 from 6 to 9\nmove 8 from 5 to 6\nmove 2 from 4 to 3\nmove 7 from 4 to 2\nmove 2 from 8 to 5\nmove 7 from 5 to 6\nmove 3 from 5 to 8\nmove 1 from 8 to 9\nmove 13 from 3 to 8\nmove 2 from 2 to 7\nmove 9 from 8 to 9\nmove 6 from 8 to 5\nmove 5 from 5 to 2\nmove 2 from 7 to 8\nmove 9 from 2 to 5\nmove 1 from 7 to 5\nmove 1 from 5 to 7\nmove 21 from 6 to 2\nmove 1 from 7 to 8\nmove 3 from 8 to 9\nmove 1 from 4 to 2\nmove 23 from 2 to 7\nmove 8 from 9 to 8\nmove 20 from 7 to 4\nmove 3 from 7 to 2\nmove 1 from 2 to 7\nmove 1 from 6 to 7\nmove 3 from 5 to 4\nmove 8 from 5 to 9\nmove 2 from 7 to 1\nmove 1 from 8 to 7\nmove 4 from 2 to 4\nmove 2 from 8 to 7\nmove 2 from 8 to 2\nmove 1 from 7 to 6\nmove 3 from 9 to 7\nmove 2 from 2 to 7\nmove 5 from 7 to 1\nmove 8 from 9 to 6\nmove 15 from 4 to 3\nmove 4 from 4 to 7\nmove 6 from 1 to 4\nmove 11 from 3 to 4\nmove 8 from 6 to 1\nmove 24 from 4 to 7\nmove 6 from 1 to 8\nmove 27 from 7 to 3\nmove 2 from 7 to 8\nmove 5 from 8 to 3\nmove 4 from 8 to 4\nmove 1 from 8 to 6\nmove 1 from 6 to 9\nmove 1 from 6 to 5\nmove 2 from 4 to 2\nmove 1 from 8 to 1\nmove 1 from 5 to 2\nmove 4 from 1 to 6\nmove 1 from 7 to 5\nmove 1 from 5 to 8\nmove 1 from 8 to 7\nmove 1 from 7 to 8\nmove 1 from 8 to 1\nmove 1 from 2 to 3\nmove 2 from 4 to 8\nmove 7 from 9 to 6\nmove 2 from 8 to 1\nmove 3 from 3 to 8\nmove 3 from 1 to 8\nmove 2 from 2 to 3\nmove 1 from 4 to 1\nmove 1 from 1 to 8\nmove 5 from 8 to 3\nmove 8 from 6 to 2\nmove 1 from 9 to 4\nmove 2 from 4 to 8\nmove 2 from 8 to 3\nmove 2 from 6 to 2\nmove 33 from 3 to 2\nmove 2 from 8 to 7\nmove 1 from 6 to 1\nmove 1 from 1 to 7\nmove 2 from 3 to 8\nmove 2 from 8 to 4\nmove 1 from 4 to 8\nmove 2 from 7 to 2\nmove 2 from 3 to 7\nmove 12 from 2 to 1\nmove 1 from 8 to 4\nmove 1 from 4 to 8\nmove 1 from 4 to 3\nmove 1 from 8 to 2\nmove 3 from 7 to 2\nmove 37 from 2 to 7\nmove 1 from 1 to 7\nmove 12 from 7 to 1\nmove 13 from 1 to 7\nmove 1 from 3 to 4\nmove 35 from 7 to 6\nmove 1 from 4 to 5\nmove 3 from 7 to 4\nmove 1 from 5 to 7\nmove 2 from 3 to 4\nmove 23 from 6 to 9\nmove 3 from 1 to 5\nmove 3 from 3 to 7\nmove 1 from 3 to 6\nmove 2 from 5 to 3\nmove 23 from 9 to 8\nmove 2 from 4 to 9\nmove 16 from 8 to 2\nmove 2 from 7 to 3\nmove 1 from 5 to 8\nmove 3 from 7 to 6\nmove 1 from 9 to 8\nmove 3 from 8 to 1\nmove 1 from 9 to 1\nmove 11 from 6 to 5\nmove 2 from 4 to 1\nmove 4 from 8 to 6\nmove 16 from 2 to 3\nmove 9 from 1 to 9\nmove 1 from 8 to 4\nmove 3 from 9 to 3\nmove 1 from 1 to 4\nmove 1 from 9 to 4\nmove 7 from 5 to 2\nmove 6 from 2 to 5\nmove 1 from 8 to 6\nmove 22 from 3 to 7\nmove 8 from 5 to 8\nmove 4 from 4 to 9\nmove 2 from 1 to 8\nmove 16 from 7 to 2\nmove 1 from 3 to 5\nmove 14 from 2 to 7\nmove 2 from 2 to 4\nmove 6 from 9 to 3")))
;(def instruction-list (translate-instructions (str/split-lines "move 1 from 2 to 1\nmove 3 from 1 to 3\nmove 2 from 2 to 1\nmove 1 from 1 to 2")))

(def starting-positions {1 [\Z \J \G] 2 [\Q \L \R \P \W \F \V \C] 3 [\F \P \M \C \L \G \R] 4 [\L \F \B \W \P \H \M] 5 [\G \C \F \S \V \Q] 6 [\W \H \J \Z \M \Q \T \L] 7 [\H \F \S \B \V] 8 [\F \J \Z \S] 9 [\M \C \D \P \F \H \B \T]})
;(def starting-positions {1 [\Z \N] 2 [\M \C \D] 3 [\P]})

(defn move [positions amount from to]
  (let [from-vec (get positions from)
        to-vec (get positions to)
        moving-vec (reverse (take-last amount from-vec))]   ; SERIOUSLY WHY DID IT TAKE ME THIS LONG TO FIGURE OUT THAT THE MOVING VEC WAS REVERSED FFS
    (println from-vec to-vec moving-vec)
    (as-> positions s
          (assoc s to (apply conj to-vec moving-vec))
          (assoc s from (subvec from-vec 0 (- (count from-vec) (count moving-vec))))))
  )

;; parses instructions and starting-positions to return a map of the final boxes.
(defn parse-instructions []
  (loop [positions starting-positions rem-instructions instruction-list]
    (println (count rem-instructions) (into (sorted-map) positions)) ; for debugging, can be removed
    (if (zero? (count rem-instructions))
      positions
      (let [i (first rem-instructions)]
        (recur
          (move positions (first i) (second i) (last i))
          (drop 1 rem-instructions))
        )
        )
      )
  )

(defn get-top []
  (str/join (map last (vals (into (sorted-map) (parse-instructions)))))
  )

(println (get-top))

; Day 5 / #2 =====================================================================================================================

; for the second challenge, all that has to be removed is the `reverse` function on line 21 :')